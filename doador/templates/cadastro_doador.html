{% load static %}
<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    {% if action_type == 'delete_doador' %}Confirmar Exclusão
    {% elif action_type == 'edit_doador' %}Editar Doador
    {% else %}Cadastrar Doador
    {% endif %} | SoliBank
  </title>

  <link rel="stylesheet" href="{% static 'skydash-free/dist/assets/vendors/select2/select2.min.css' %}">
  <link rel="stylesheet" href="{% static 'skydash-free/dist/assets/vendors/select2-bootstrap-theme/select2-bootstrap.min.css' %}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* --- seu CSS original, mantido --- */
    body { margin:0; padding:0; background: linear-gradient(135deg,#1b362e,#416358,#0f6e4a); background-size:cover; min-height:100vh; font-family:Arial, sans-serif; display:flex; justify-content:center; align-items:center; }
    .doador-container { width:90%; max-width:1200px; min-height:550px; background:#fff; display:flex; border-radius:18px; overflow:hidden; box-shadow:0 0 20px rgba(0,0,0,0.35); margin:20px; }
    .image-side { background:#fff; width:40%; background-image:url("{% static 'img/logo.png' %}"); background-size:70%; background-repeat:no-repeat; background-position:center; display:flex; align-items:center; justify-content:center; }
    .form-side { width:60%; background:#fff; padding:40px 50px; display:flex; flex-direction:column; justify-content:center; }
    label { font-weight:600; color:#345246; margin-bottom:5px; display:block; }
    .mb-3 { margin-bottom:1rem !important; }
    .form-control { width:100%; margin-top:6px; margin-bottom:0px; border-radius:6px; border:1px solid #b3ccb3; padding:10px; transition:border-color .2s, box-shadow .2s; }
    .btn-submit-custom { background:#0f6e4a; border:none; padding:12px 20px; border-radius:6px; color:#fff; font-weight:bold; cursor:pointer; }
    .btn-custom-secondary { background:#f8f9fa; border:2px solid #0f6e4a; color:#0f6e4a; padding:12px 20px; border-radius:6px; font-weight:bold; text-decoration:none; }
    .form-error { color:#7b0000; font-size:14px; margin-top:5px; margin-bottom:0; display:block; }
    .cpf-cnpj-field.hidden { display:none; }
    @media (max-width:992px){ .doador-container{ width:95%; height:auto; flex-direction:column; } .image-side{ display:none; } .form-side{ width:100%; padding:30px; } }
    /* --- fim CSS --- */
  </style>
</head>

<body>
  <div class="doador-container">
    <div class="image-side"></div>

    <div class="form-side">

      <!-- TÍTULO EXTERNO -->
      <div style="margin-bottom:12px; text-align:center;">
        {% if action_type == 'delete_doador' %}
          <h2 style="color:#0c4a31; margin:0;">Excluir Doador</h2>
          <p style="margin:4px 0 18px 0; color:#555;">Confirme a exclusão do registro.</p>
        {% elif action_type == 'edit_doador' %}
          <h2 style="color:#0c4a31; margin:0;">Editar Doador</h2>
          <p style="margin:4px 0 18px 0; color:#555;">Atualize os dados do doador.</p>
        {% else %}
          <h2 style="color:#0c4a31; margin:0;">Cadastrar Doador</h2>
          <p style="margin:4px 0 18px 0; color:#555;">Preencha os campos para transformar vidas.</p>
        {% endif %}
      </div>

      {# Exibe erros gerais do form (non-field) #}
      {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {% for err in form.non_field_errors %}
          <div>{{ err }}</div>
        {% endfor %}
      </div>
      {% endif %}

      {% if action_type == 'delete_doador' %}
        <form action="{% url 'deletar_doador' doador.id %}" method="post">
          {% csrf_token %}
          <div class="delete-message-box mb-4">
            <h5 class="text-danger mb-2">⚠️ Confirma a exclusão do registro de <strong>{{ doador.nome }}</strong>?</h5>
            <p class="mb-0 text-muted">Esta ação é irreversível.</p>
          </div>

          <div class="d-flex justify-content-end gap-3 mt-4">
            <a href="{% url 'listar_doador' %}" class="btn btn-custom-secondary">Cancelar</a>
            <button type="submit" class="btn btn-danger btn-submit-custom">Deletar</button>
          </div>
        </form>

      {% elif action_type == 'edit_doador' %}
        <form action="{% url 'editar_doador' doador.id %}" method="post">
          {% csrf_token %}
          {% for field in form %}
            <div class="mb-3">
              <label for="{{ field.id_for_label }}">{{ field.label }}</label>
              {{ field }}
              {% for error in field.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
          {% endfor %}

          <div class="d-flex justify-content-end gap-3 mt-4">
            <a href="{% url 'listar_doador' %}" class="btn btn-custom-secondary">Cancelar</a>
            <button type="submit" class="btn btn-submit-custom">Salvar Alterações</button>
          </div>
        </form>

      {% else %}
        <form action="{% url 'cadastro_doador' %}" method="post">
          {% csrf_token %}

          <div class="row">
            <div class="col-md-6">
              <h5 class="mb-3" style="color:#0c4a31;">Dados de Acesso</h5>

              {# username #}
              <div class="mb-3">
                <label for="{{ form.username.id_for_label }}">{{ form.username.label }}</label>
                {{ form.username }}
                {% for e in form.username.errors %}
                <div class="form-error">{{ e }}</div>
                {% endfor %}
              </div>

              {# email #}
              <div class="mb-3">
                <label for="{{ form.email.id_for_label }}">{{ form.email.label }}</label>
                {{ form.email }}
                {% for e in form.email.errors %}
                <div class="form-error">{{ e }}</div>
                {% endfor %}
              </div>

              {# password1 #}
              <div class="mb-3">
                <label for="{{ form.password1.id_for_label }}">{{ form.password1.label }}</label>
                {{ form.password1 }}
                {% for e in form.password1.errors %}
                <div class="form-error">{{ e }}</div>
                {% endfor %}
              </div>

              {# password2 #}
              <div class="mb-3">
                <label for="{{ form.password2.id_for_label }}">{{ form.password2.label }}</label>
                {{ form.password2 }}
                {% for e in form.password2.errors %}
                <div class="form-error">{{ e }}</div>
                {% endfor %}
              </div>
            </div>

            <div class="col-md-6">
              <h5 class="mb-3" style="color:#0c4a31;">Dados Pessoais/Empresariais</h5>

              <div class="mb-3" id="tipo-field">
                <label for="{{ form.tipo.id_for_label }}">{{ form.tipo.label }}</label>
                {{ form.tipo }}
                {% for e in form.tipo.errors %}
                <div class="form-error">{{ e }}</div>
                {% endfor %}
              </div>

              <div class="mb-3">
                <label for="{{ form.nome.id_for_label }}">{{ form.nome.label }}</label>
                {{ form.nome }}
                {% for e in form.nome.errors %}
                <div class="form-error">{{ e }}</div>
                {% endfor %}
              </div>

              <div class="mb-3 cpf-cnpj-field" id="cpf-field">
                <label for="{{ form.cpf.id_for_label }}">CPF</label>
                {{ form.cpf }}
                {% for e in form.cpf.errors %}
                <div class="form-error">{{ e }}</div>
                {% endfor %}
              </div>

              <div class="mb-3 cpf-cnpj-field hidden" id="cnpj-field">
                <label for="{{ form.cnpj.id_for_label }}">CNPJ</label>
                {{ form.cnpj }}
                {% for e in form.cnpj.errors %}
                <div class="form-error">{{ e }}</div>
                {% endfor %}
              </div>

              {% if form.telefone %}
              <div class="mb-3">
                <label for="{{ form.telefone.id_for_label }}">Telefone</label>
                {{ form.telefone }}
                {% for e in form.telefone.errors %}
                <div class="form-error">{{ e }}</div>
                {% endfor %}
              </div>
              {% endif %}

              {% if form.endereco %}
              <div class="mb-3">
                <label for="{{ form.endereco.id_for_label }}">Endereço</label>
                {{ form.endereco }}
                {% for e in form.endereco.errors %}
                <div class="form-error">{{ e }}</div>
                {% endfor %}
              </div>
              {% endif %}
            </div>
          </div>

          <div class="d-flex justify-content-end gap-3 mt-4">
            <a href="{% url 'index' %}" class="btn btn-custom-secondary">Cancelar</a>
            <button type="submit" class="btn btn-submit-custom">Realizar Cadastro</button>
          </div>
        </form>
      {% endif %}
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const tipoSelect = document.getElementById('id_tipo');
      const cpfField = document.getElementById('cpf-field');
      const cnpjField = document.getElementById('cnpj-field');
      const nomeRazaoField = document.querySelector('.form-side label[for="id_nome"]');

      function updateNameLabel(tipo) {
        if (nomeRazaoField) {
          if (tipo === 'PF') {
            nomeRazaoField.textContent = 'Nome Completo';
          } else if (tipo === 'PJ') {
            nomeRazaoField.textContent = 'Nome/Razão Social';
          }
        }
      }

      function AlterarCampo() {
        const selectedType = tipoSelect ? tipoSelect.value : null;
        updateNameLabel(selectedType);

        if (selectedType === 'PF') {
          cpfField && cpfField.classList.remove('hidden');
          cnpjField && cnpjField.classList.add('hidden');
          const cnpjInput = cnpjField && cnpjField.querySelector('input, textarea');
          if (cnpjInput) cnpjInput.value = '';
        } else if (selectedType === 'PJ') {
          cpfField && cpfField.classList.add('hidden');
          cnpjField && cnpjField.classList.remove('hidden');
          const cpfInput = cpfField && cpfField.querySelector('input, textarea');
          if (cpfInput) cpfInput.value = '';
        }
      }

      if (tipoSelect) {
        AlterarCampo();
        tipoSelect.addEventListener('change', AlterarCampo);
      }
    });
  </script>
</body>

</html>
